var status = -1;

function start() {
    status = -1;
    action(1, 0, 0);
}

function action(mode, type, selection) {
    if (mode == 1) {
	status++;
    } else {
	status--;
    }
    if (status == 0) {
	if (cm.haveItem(5220000)) {
	    cm.sendYesNo("You have some #bGachapon Tickets#k there.\r\nWould you like to try your luck?");
	} else {
	    cm.sendOk("You don't have a single ticket with you. Please buy the ticket at the department store before coming back to me. Thank you.");
	    cm.safeDispose();
	}
    } else if (status == 1) {
	var item;
	if (Math.floor(Math.random() * 300) == 0) {
	    item = cm.gainGachaponItem(1102042, 1);
	} else {
	    var itemList = new Array(2040317, 3010013, 2000005, 2022113, 2043201, 2044001, 2041038, 2041039, 2041036, 2041037, 2041040, 2041041, 2041026, 2041027, 
		2044600, 2043301, 2040308, 2040309, 2040304, 2040305, 2040810, 2040811, 2040812, 2040813, 2040814, 2040815, 2040008, 2040009, 2040010, 2040011, 
		2040012, 2040013, 2040510, 2040511, 2040508, 2040509, 2040518, 2040519, 2040520, 2040521, 2044401, 2040900, 2040902, 2040908, 2040909, 2044301, 
		2040406, 2040407, 1302026, 2000005, 2022113, 2002018, 1382001, 1050008, 1442017, 1002084, 1050003, 1002064, 1061006, 1051027, 1442009, 1050056, 
		1051047, 1050049, 1040080, 1051055, 1372010, 1422005, 1002143, 1302027, 1061087, 1372003, 1302019, 1051023, 1050054, 1061083, 1051017, 1002028, 
		1322010, 1332013, 1050055, 1002245, 2022176, 2022113, 2043202, 2043201, 2044102, 2044101, 2040602, 2040601, 2043302, 2043301, 2040002, 2040001, 
		2044402, 2002017, 1402010, 1312014, 1442017, 1002063, 1060062, 1050018, 1002392, 1040037, 1002160, 1060005, 1332009, 1332008, 1442009, 1302004, 
		1312006, 1002154, 1002175, 1060064, 1061088, 1402012, 1002024, 1312005, 1432002, 1302050, 1002048, 1040061, 1041067, 1002131, 1072263, 1332001, 
		1312027, 1322015, 1432006, 1041088, 1061087, 1402013, 1302051, 1002023, 1402006, 1322000, 1372002, 1442001, 1422004, 1432003, 1040088, 1002100, 
		1041004, 1061047, 1322022, 1040021, 1061091, 1102012, 1050006, 1060018, 1041044, 1041024, 1041087, 1082146, 1332043, 1062001, 1051014, 1402030, 
		1432004, 1060060, 1432018, 1002096, 1442010, 1422003, 1472014, 1002021, 1060060, 1442031, 1402000, 1040089, 1432005, 5062002, 5062003, 5062005, 
		2340000, 2049100, 3010014, 3010043, 3010073, 3010072, 3010068, 3010085, 3010118, 3010124, 3010125, 3010131, 3010137, 3010156, 3010615, 3010592, 
		3010602, 3010670, 3010728, 1342033, 1482079, 
	        1322090, 1102041, 1022082, 1072238, 2040834, 2044102, 2044502, 2041020, 2041017, 2041011, 2041014, 2044702, 2044602, 2043302, 2040302, 2040805,
		2040502, 2044402, 2040902, 2040708, 2040402, 2043002, 2044101, 2041022, 2044701, 2040804, 2040702,
		2040707, 2043801, 2044001, 2043701, 2048003, 2048000, 2060001, 2020002, 2012003,
		2030006, 2030007, 2030019, 2020000, 2012002, 2050002,
		2002003, 1032003, 1302022, 1432009, 1102014, 1102018, 1322023, 1322025, 1032008, 1432008,
		1322022, 1442018, 1442039, 1322027, 1032004, 1032026, 1442015, 1032016, 1032018, 1422004, 1422006,
		1302021, 1322024, 1322012, 1051017, 1432015, 1032001, 1432018, 1432000, 1402014, 1032000, 1422000,
		1032009, 1082145, 1452004, 1452000, 1002162, 1452003, 1040068, 1060057, 1002163, 1452001, 1002161,
		1002038, 1002036, 1002013, 1372002, 1372003, 1040044, 1041048, 1041049, 1002150, 1472004, 1002175,
		1472003, 1472002, 1041050, 1041047, 1332013, 1060019, 1442009, 1442006, 1422002, 1402003, 1040021,
		1442010, 1002009, 1442007, 1442031, 1332002, 1060017, 2100000, 2044902, 2044901, 2044803, 2044804,
		1472010, 1402010, 1382001, 1452000, 1302026, 1472023, 1472019, 1472022, 1102011, 1472033,
		1402017, 1442009, 1472013, 1472021, 1472075, 2000004, 1382005, 1332030, 1432001, 2044901, 2044902,
		1422025, 1442015, 1432017, 1442025, 1312004, 1322015, 1462005, 1312012, 1302003, 1442004, 1302028,
		1402006, 1322000, 2022195, 1412001, 1372002, 1472009, 1422001, 1462000, 1412004, 1452008, 1432016,
		1302021, 4000176, 1442000, 2022113, 1432013, 1322024, 1322012, 1302012, 1102028, 1452006,
		1302013, 1462007, 1332016, 2043102, 2043112, 2044101, 2044002, 2044001, 2041011, 2041010, 2044602,
		2044601, 2043305, 2044401, 2044314, 2043702, 2043701, 1432004, 1472054, 1462006, 1472012, 1442010,
		1472008, 1472005, 1382006, 1422007, 1332000, 1402000, 1452007, 1402009, 1102029, 1402001,
		1372005, 1442021, 2040915, 2040919, 2040920, 2040914, 2041301, 2041304, 2041307, 2041310, 2044803,
		2049000, 2340000, 2049100, 1372039, 1372040, 1092049, 1041115, 1041116, 1041117, 1041118, 1060107, 1060106, 1060105,
                1060104, 1061116, 1061117, 1061114, 1061115, 1040115, 1040117, 1040116, 1040118, 1072194, 1072195, 1072192, 1072193, 1002323, 1002325, 1002324,
                1002326, 1442018);
	    item = cm.gainGachaponItem(itemList[Math.floor(Math.random() * itemList.length)], 1);
	}

	if (item != -1) {
	    cm.gainItem(5220000, -1);
	    cm.sendOk("You have obtained #b#t" + item + "##k.");
	} else {
	    cm.sendOk("Please check your item inventory and see if you have the ticket, or if the inventory is full.");
	}
	cm.safeDispose();
    }
}